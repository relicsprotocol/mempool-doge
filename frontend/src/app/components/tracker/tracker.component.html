<div class="mobile-wrapper">
  <div class="mobile-container">
    <div class="panel">
      <div class="nav-header">
      </div>
      <div class="field">
        <div class="label" i18n="shared.transaction">Transaction</div>
        <div class="value">
          <app-truncate [text]="txId" [lastChars]="12" [link]="['/tx/' | relativeUrl, txId]">
            <app-clipboard [text]="txId"></app-clipboard>
          </app-truncate>
        </div>
      </div>
    </div>
      <div class="blockchain-wrapper" [style]="{ height: blockchainHeight * 1.16 + 'px' }">
        <app-clockchain [height]="blockchainHeight" [width]="blockchainWidth" mode="none"></app-clockchain>
      </div>
    <div class="panel">
      @if (replaced) {
        <div class="alert-replaced" role="alert">
          <span i18n="transaction.rbf.replacement|RBF replacement">This transaction has been replaced by:</span>
          <app-truncate [text]="latestReplacement" [lastChars]="12" [link]="['/tx/' | relativeUrl, latestReplacement]" [queryParams]="{mode: 'status'}"></app-truncate>
        </div>
      } @else {
        <div class="tracker-bar">
          <app-tracker-bar [stage]="trackerStage"></app-tracker-bar>
        </div>
      }
      <div class="data">
        @if (tx && !tx.status?.confirmed) {
          <div class="field narrower mt-2">
            <div class="label" i18n="transaction.first-seen|Transaction first seen">First seen</div>
            <div class="value">
              @if (transactionTime > 0) {
                <i><app-time kind="since" [time]="transactionTime" [fastRender]="true" [showTooltip]="true"></app-time></i>
              } @else {
                <span class="skeleton-loader" style="max-width: 200px;"></span>
              }
            </div>
          </div>
          <div class="field narrower">
            <div class="label" i18n="transaction.eta|Transaction ETA">ETA</div>
            <div class="value">
              <ng-container *ngIf="(ETA$ | async) as eta; else etaSkeleton">
                <span class="justify-content-end d-flex align-items-center">
                  @if (eta.blocks >= 7) {
                    <span i18n="transaction.eta.not-any-time-soon|Transaction ETA mot any time soon">Not any time soon</span>
                  } @else {
                    <app-time kind="until" [time]="eta.time" [fastRender]="false" [fixedRender]="true"></app-time>
                  }
                </span>
              </ng-container>
              <ng-template #etaSkeleton>
                <span class="skeleton-loader" style="max-width: 200px;"></span>
              </ng-template>
            </div>
          </div>
        } @else if (tx && tx.status?.confirmed) {
          <div class="field narrower mt-2">
            <div class="label" i18n="transaction.confirmed-at">Confirmed at</div>
            <div class="value">
              &lrm;{{ tx.status.block_time * 1000 | date:'yyyy-MM-dd HH:mm' }}
              <div class="lg-inline">
                <i class="symbol">(<app-time kind="since" [time]="tx.status.block_time" [fastRender]="true" [showTooltip]="true"></app-time>)</i>
              </div>
            </div>
          </div>
          <div class="field narrower">
            <div class="label" i18n="transaction.block-height">Block height</div>
            <div class="value">
              <span class="justify-content-end d-flex align-items-center">
                <a [routerLink]="['/block/' | relativeUrl, tx.status?.block_height]" class="block-link">{{ tx.status?.block_height }}</a>
                <div class="confirmations">
                  <app-confirmations
                    *ngIf="tx"
                    [chainTip]="latestBlock?.height"
                    [height]="tx?.status?.block_height"
                  ></app-confirmations>
                </div>
              </span>
            </div>
          </div>
        }
      </div>
    </div>

    <div class="bottom-panel">
      @if (isLoading) {
        <div class="progress-icon">
          <div class="spinner-border text-light" style="width: 1em; height: 1em"></div>
        </div>
        <span class="explainer">&nbsp;</span>
      } @else {
        <div class="status-panel d-flex flex-column h-100 w-100 justify-content-center align-items-center">
          @switch (trackerStage) {
            @case ('waiting') {
              <div class="progress-icon">
                <div class="spinner-border text-light" style="width: 1em; height: 1em"></div>
              </div>
              <span class="explainer" i18n="tracker.explain.waiting">Waiting for your transaction to appear in the mempool</span>
            }
            @case ('pending') {
              <div class="progress-icon">
                <fa-icon [icon]="['fas', 'hourglass-start']" [fixedWidth]="true"></fa-icon>
              </div>
              <span class="explainer" i18n="tracker.explain.pending">Your transaction is in the mempool, but it will not be confirmed for some time.</span>
            }
            @case ('soon') {
              <div class="progress-icon">
                <fa-icon [icon]="['fas', 'hourglass-half']" [fixedWidth]="true"></fa-icon>
              </div>
              <span class="explainer" i18n="tracker.explain.soon">Your transaction is near the top of the mempool, and is expected to confirm soon.</span>
            }
            @case ('next') {
              <div class="progress-icon">
                <fa-icon [icon]="['fas', 'hourglass-end']" [fixedWidth]="true"></fa-icon>
              </div>
              <span class="explainer" i18n="tracker.explain.next-block">Your transaction is expected to confirm in the next block</span>
            }
            @case ('confirmed') {
              <div class="progress-icon">
                <fa-icon [icon]="['fas', 'circle-check']" [fixedWidth]="true"></fa-icon>
              </div>
              <span class="explainer" i18n="tracker.explain.confirmed">Your transaction is confirmed!</span>
            }
            @case ('replaced') {
              <div class="progress-icon">
                <fa-icon [icon]="['fas', 'timeline']" [fixedWidth]="true"></fa-icon>
              </div>
              <span class="explainer" i18n="tracker.explain.replaced">Your transaction has been replaced by a newer version!</span>
            }
          }
        </div>
      }
    </div>

    <div class="footer-link"
      [routerLink]="['/tx' | relativeUrl, tx?.txid || txId]"
      [queryParams]="{ mode: 'details' }"
      queryParamsHandling="merge"
    >
      <span><ng-container i18n="accelerator.show-more-details">See more details</ng-container>&nbsp;<fa-icon [icon]="['fas', 'arrow-alt-circle-right']"></fa-icon></span>
    </div>
  </div>
</div>
